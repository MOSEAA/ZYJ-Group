11.4

已知将世界坐标系转化为相机坐标系的公式如下：

![image-20221104100614306](assets/image-20221104100614306.png)

<img src="assets/屏幕截图 2022-11-02 155146.png" alt="屏幕截图 2022-11-02 155146" style="zoom: 50%;" />

其中$k$为相机内参矩阵，$[R,t]$代表相机外参矩阵。$M$代表目标在世界坐标系的模型矩阵，描述了目标在世界中的旋转角与平移量，在实验中卫星没有转动，所以M为单位矩阵。而相机外参矩阵中的$R$表示为：

![image-20221104100629887](assets/image-20221104100629887.png)

如果以相机为参考系，描述卫星相对于相机的旋转运动就可以表示为：

![image-20221104100651554](assets/image-20221104100651554.png)

<img src="assets/屏幕截图 2022-11-02 153803.png" alt="屏幕截图 2022-11-02 153803" style="zoom:75%;" />

以相机为参考的世界坐标系转为相机坐标系公式如下：

![image-20221104100706928](assets/image-20221104100706928.png)

利用关键点求解完当前帧的卫星姿态后输入到卡尔曼滤波器中，对状态进行更新。

![image-20221104100730058](assets/image-20221104100730058.png)

其中$$\theta_{rot}^{k}，\phi_{rot}^{k}，\omega_{rot}^{k}$$为k时刻的卫星旋转角，$\Delta t$为采样时间间隔， $\theta_{v}^{k}$为采样间隔（k-1时刻~k时刻）的平均角速度。平均误差在4°左右，滤波结果如下图所示：

<img src="assets/pitch.png" alt="pitch" style="zoom: 67%;" />

<img src="assets/yaw.png" alt="yaw" style="zoom:67%;" />

<img src="assets/roll.png" alt="roll" style="zoom:67%;" />